# LepiNet System Architecture - Visual Diagrams

## ğŸ¨ Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           LepiNet Ecosystem                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mobile     â”‚         â”‚     Web      â”‚         â”‚   Admin      â”‚
â”‚     App      â”‚         â”‚   Portal     â”‚         â”‚  Dashboard   â”‚
â”‚  (Flutter)   â”‚         â”‚  (Next.js)   â”‚         â”‚  (Next.js)   â”‚
â”‚              â”‚         â”‚              â”‚         â”‚              â”‚
â”‚ - Camera     â”‚         â”‚ - Browse     â”‚         â”‚ - Manage     â”‚
â”‚ - Upload     â”‚         â”‚ - Review     â”‚         â”‚   Users      â”‚
â”‚ - Results    â”‚         â”‚ - Comment    â”‚         â”‚ - Training   â”‚
â”‚ - History    â”‚         â”‚ - Profile    â”‚         â”‚ - Models     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚                        â”‚                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Supabase Backend    â”‚
                    â”‚                       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   PostgreSQL    â”‚  â”‚
                    â”‚  â”‚    Database     â”‚  â”‚
                    â”‚  â”‚                 â”‚  â”‚
                    â”‚  â”‚ - ai_logs       â”‚  â”‚
                    â”‚  â”‚ - expert_reviewsâ”‚  â”‚
                    â”‚  â”‚ - species       â”‚  â”‚
                    â”‚  â”‚ - users         â”‚  â”‚
                    â”‚  â”‚ - model_versionsâ”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚  Object Storage â”‚  â”‚
                    â”‚  â”‚                 â”‚  â”‚
                    â”‚  â”‚ /butterfly-     â”‚  â”‚
                    â”‚  â”‚  images/        â”‚  â”‚
                    â”‚  â”‚   â””â”€ user-      â”‚  â”‚
                    â”‚  â”‚      uploads/   â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚  Auth Service   â”‚  â”‚
                    â”‚  â”‚  (JWT Tokens)   â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ image_url
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  HuggingFace API      â”‚
                    â”‚                       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚  AI Model       â”‚  â”‚
                    â”‚  â”‚  (PyTorch)      â”‚  â”‚
                    â”‚  â”‚                 â”‚  â”‚
                    â”‚  â”‚ Bhanura/        â”‚  â”‚
                    â”‚  â”‚ lepinet-model   â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ Species CSV     â”‚  â”‚
                    â”‚  â”‚ 245 species     â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: Image to Identification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Image Identification Pipeline                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[1] User Takes Photo
         â”‚
         â”‚  ğŸ“¸ Image (JPEG/PNG)
         â–¼
[2] Mobile App Compresses
         â”‚
         â”‚  Optimized Image
         â–¼
[3] Upload to Supabase Storage
         â”‚
         â”‚  âœ… Returns: public_url
         â–¼
[4] Create ai_logs Entry
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Database â”‚
    â”‚ Record:  â”‚
    â”‚ id       â”‚
    â”‚ user_id  â”‚
    â”‚ image_urlâ”‚
    â”‚ status   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â”‚  image_url
         â–¼
[5] POST to HuggingFace API
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ HuggingFace Inference   â”‚
    â”‚                         â”‚
    â”‚ [6] Fetch image from URLâ”‚
    â”‚        â”‚                â”‚
    â”‚        â–¼                â”‚
    â”‚ [7] Preprocess          â”‚
    â”‚     - Resize 224x224    â”‚
    â”‚     - Normalize         â”‚
    â”‚        â”‚                â”‚
    â”‚        â–¼                â”‚
    â”‚ [8] CNN Forward Pass    â”‚
    â”‚     Input Layer         â”‚
    â”‚       â”‚                 â”‚
    â”‚     Conv Layers         â”‚
    â”‚       â”‚                 â”‚
    â”‚     FC Layers           â”‚
    â”‚       â”‚                 â”‚
    â”‚     Output: [245 scores]â”‚
    â”‚        â”‚                â”‚
    â”‚        â–¼                â”‚
    â”‚ [9] Get Max Index       â”‚
    â”‚     class_idx = 42      â”‚
    â”‚     confidence = 0.9234 â”‚
    â”‚        â”‚                â”‚
    â”‚        â–¼                â”‚
    â”‚ [10] Lookup CSV         â”‚
    â”‚      df.iloc[42]        â”‚
    â”‚        â”‚                â”‚
    â”‚        â–¼                â”‚
    â”‚ [11] Return JSON        â”‚
    â”‚ {                       â”‚
    â”‚   predicted_id: "043",  â”‚
    â”‚   name: "Blue Tiger",   â”‚
    â”‚   scientific: "Tirumala"â”‚
    â”‚   confidence: 0.9234    â”‚
    â”‚ }                       â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  Prediction Result
         â–¼
[12] Update ai_logs
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database       â”‚
    â”‚ predicted_id   â”‚
    â”‚ confidence     â”‚
    â”‚ species_name   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  Complete Data
         â–¼
[13] Display to User
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Mobile Screen  â”‚
    â”‚ ğŸ¦‹ Blue Tiger  â”‚
    â”‚ 92.34%         â”‚
    â”‚ [âœ“] [âœ—]        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  User Action
         â–¼
[14] Update user_action
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ user_action:   â”‚
    â”‚ "ACCEPTED"     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¨â€ğŸ« Expert Review Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Expert Review & Training Pipeline           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[User Record Exists]
         â”‚
         â”‚  ai_logs entry with prediction
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Portal        â”‚
â”‚  /records          â”‚
â”‚                    â”‚
â”‚  List of Records   â”‚
â”‚  [Record 1] Review â”‚
â”‚  [Record 2] Review â”‚â—„â”€â”€â”€ Expert Browses
â”‚  [Record 3] Review â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  Expert clicks "Review"
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /review/[id]      â”‚
â”‚                    â”‚
â”‚  ğŸ“· Image          â”‚
â”‚  AI Said: X        â”‚
â”‚  Confidence: 92%   â”‚
â”‚                    â”‚
â”‚  Your Opinion:     â”‚
â”‚  â—‹ Agree           â”‚
â”‚  â— Correct to Y    â”‚
â”‚  â—‹ Unsure          â”‚
â”‚                    â”‚
â”‚  Confidence:       â”‚
â”‚  â— Certain         â”‚
â”‚  â—‹ Uncertain       â”‚
â”‚                    â”‚
â”‚  [Submit Review]   â”‚â—„â”€â”€â”€ Expert Submits
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚  Form Data
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  expert_reviews table      â”‚
â”‚                            â”‚
â”‚  id: uuid                  â”‚
â”‚  ai_log_id: [links back]   â”‚
â”‚  reviewer_id: expert-uuid  â”‚
â”‚  agreed_with_ai: false     â”‚
â”‚  identified_species: "Y"   â”‚
â”‚  confidence_level: certain â”‚
â”‚  training_status: pending  â”‚
â”‚  comments: "Pattern shows" â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  Triggers notification
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  notifications   â”‚
â”‚  â†’ Record Owner  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /admin/training           â”‚
â”‚                            â”‚
â”‚  [Review List]             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Image | Species | âœ“â”‚   â”‚â—„â”€â”€â”€ Admin Reviews
â”‚  â”‚ Photo | Blue Tig| â–¡â”‚   â”‚
â”‚  â”‚ [Ready] [Ignore]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  Admin marks "Ready"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  expert_reviews            â”‚
â”‚  training_status: ready    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Training Script           â”‚
â”‚  (trainer.py)              â”‚
â”‚                            â”‚
â”‚  [1] Query reviews WHERE   â”‚
â”‚      training_status='ready'â”‚
â”‚                            â”‚
â”‚  [2] Download images       â”‚
â”‚                            â”‚
â”‚  [3] Create dataset        â”‚
â”‚      train/001/*.jpg       â”‚
â”‚      train/002/*.jpg       â”‚
â”‚                            â”‚
â”‚  [4] Fine-tune model       â”‚
â”‚                            â”‚
â”‚  [5] Validate accuracy     â”‚
â”‚                            â”‚
â”‚  [6] Push to HuggingFace   â”‚
â”‚      "v2.1.0"              â”‚
â”‚                            â”‚
â”‚  [7] Log to database       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  New model created
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  model_versions table      â”‚
â”‚                            â”‚
â”‚  version_name: "v2.1.0"    â”‚
â”‚  file_path: "Bhanura/..."  â”‚
â”‚  accuracy: 0.9456          â”‚
â”‚  is_active: false          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  Admin activates
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UPDATE model_versions     â”‚
â”‚  SET is_active = true      â”‚
â”‚  WHERE version = "v2.1.0"  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  Production Ready
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HuggingFace API           â”‚
â”‚  Uses new model v2.1.0     â”‚
â”‚                            â”‚
â”‚  Improved accuracy! ğŸ‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              User Authentication Flow                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mobile App/Web Portal
        â”‚
        â”‚  POST /auth/signup or /auth/login
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Auth    â”‚
â”‚                   â”‚
â”‚  [1] Verify       â”‚
â”‚      credentials  â”‚
â”‚         â”‚         â”‚
â”‚         â–¼         â”‚
â”‚  [2] Generate JWT â”‚
â”‚      Token        â”‚
â”‚         â”‚         â”‚
â”‚         â–¼         â”‚
â”‚  [3] Create       â”‚
â”‚      session      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  Returns: access_token, refresh_token
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client stores     â”‚
â”‚  in secure storage â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  For each request
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Authorization Header  â”‚
â”‚  Bearer <access_token> â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  middleware.ts          â”‚
â”‚                         â”‚
â”‚  [1] Verify token       â”‚
â”‚         â”‚               â”‚
â”‚         â–¼               â”‚
â”‚  [2] Extract user_id    â”‚
â”‚         â”‚               â”‚
â”‚         â–¼               â”‚
â”‚  [3] Query users table  â”‚
â”‚      for role           â”‚
â”‚         â”‚               â”‚
â”‚         â–¼               â”‚
â”‚  [4] Check permissions  â”‚
â”‚      - /admin/* â†’admin  â”‚
â”‚      - /review/* â†’expertâ”‚
â”‚         â”‚               â”‚
â”‚         â–¼               â”‚
â”‚  [5] Allow/Deny         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  Request proceeds or redirects
     â–¼
Protected Resource
```

---

## ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Database Schema                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  auth.users  â”‚           â”‚  public.users   â”‚
â”‚              â”‚           â”‚                 â”‚
â”‚  id (PK)     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  id (PK, FK)    â”‚
â”‚  email       â”‚           â”‚  first_name     â”‚
â”‚  password    â”‚           â”‚  last_name      â”‚
â”‚  created_at  â”‚           â”‚  role           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  verification_  â”‚
       â”‚                   â”‚   status        â”‚
       â”‚                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚                        â”‚ reviewer_id
       â”‚                        â”‚
       â”‚                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                   â”‚ expert_reviews   â”‚
       â”‚                   â”‚                  â”‚
       â”‚                   â”‚  id (PK)         â”‚
       â”‚                   â”‚  ai_log_id (FK)  â”‚
       â”‚                   â”‚  reviewer_id(FK) â”‚
       â”‚                   â”‚  agreed_with_ai  â”‚
       â”‚                   â”‚  identified_     â”‚
       â”‚                   â”‚   species_name   â”‚
       â”‚                   â”‚  training_status â”‚
       â”‚                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚                        â”‚ ai_log_id
       â”‚                        â”‚
       â”‚  user_id          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  ai_logs         â”‚
                           â”‚                  â”‚
                           â”‚  id (PK)         â”‚
                           â”‚  user_id (FK)    â”‚
                           â”‚  image_url       â”‚
                           â”‚  predicted_id(FK)â”‚
                           â”‚  predicted_      â”‚
                           â”‚   confidence     â”‚
                           â”‚  user_action     â”‚
                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ predicted_id
                                â”‚
                           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  species         â”‚
                           â”‚                  â”‚
                           â”‚  butterfly_id(PK)â”‚
                           â”‚  common_name_    â”‚
                           â”‚   english        â”‚
                           â”‚  species_name_   â”‚
                           â”‚   binomial       â”‚
                           â”‚  family          â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Additional Tables:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ review_comments â”‚       â”‚  notifications   â”‚
â”‚                 â”‚       â”‚                  â”‚
â”‚ id (PK)         â”‚       â”‚  id (PK)         â”‚
â”‚ review_id (FK)  â”‚       â”‚  user_id (FK)    â”‚
â”‚ commenter_id(FK)â”‚       â”‚  type            â”‚
â”‚ comment_text    â”‚       â”‚  message         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  is_read         â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ model_versions  â”‚
â”‚                 â”‚
â”‚ id (PK)         â”‚
â”‚ version_name    â”‚
â”‚ file_path       â”‚
â”‚ accuracy_score  â”‚
â”‚ is_active       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Mobile App Screen Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Mobile App Navigation              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Splash Screen]
      â”‚
      â–¼
[Login/Signup] â”€â”€â”€â”€â”
      â”‚            â”‚
      â”‚  Authenticated
      â–¼            â”‚
[Home Dashboard]â—„â”€â”€â”˜
      â”‚
      â”œâ”€â”€â–º [My Records]
      â”‚         â”‚
      â”‚         â””â”€â”€â–º [Record Detail]
      â”‚                   â”‚
      â”‚                   â””â”€â”€â–º [View Reviews]
      â”‚
      â”œâ”€â”€â–º [Camera]
      â”‚         â”‚
      â”‚         â”œâ”€â”€â–º [Take Photo]
      â”‚         â”‚         â”‚
      â”‚         â”‚         â–¼
      â”‚         â”‚    [Preview]
      â”‚         â”‚         â”‚
      â”‚         â”‚         â–¼
      â”‚         â”‚    [Uploading...]
      â”‚         â”‚         â”‚
      â”‚         â”‚         â–¼
      â”‚         â”‚    [Identifying...]
      â”‚         â”‚         â”‚
      â”‚         â”‚         â–¼
      â”‚         â””â”€â”€â–º [Result Screen]
      â”‚                   â”‚
      â”‚                   â”œâ”€â”€â–º âœ“ Accept
      â”‚                   â””â”€â”€â–º âœ— Reject
      â”‚
      â”œâ”€â”€â–º [Browse All Records]
      â”‚         â”‚
      â”‚         â””â”€â”€â–º [Filter by Species]
      â”‚
      â”œâ”€â”€â–º [Profile]
      â”‚         â”‚
      â”‚         â”œâ”€â”€â–º [Edit Profile]
      â”‚         â”œâ”€â”€â–º [Statistics]
      â”‚         â””â”€â”€â–º [Apply for Expert]
      â”‚
      â””â”€â”€â–º [Notifications]
                â”‚
                â””â”€â”€â–º [Open Notification]
                          â”‚
                          â””â”€â”€â–º [Navigate to Record]
```

---

## ğŸŒ Web Portal Page Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Web Portal (Next.js)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

/                           (Home - public)
â”‚
â”œâ”€â”€ /login                  (Login page)
â”œâ”€â”€ /signup                 (Registration)
â”‚
â”œâ”€â”€ /dashboard              (User/Expert Dashboard)
â”‚   â”œâ”€â”€ My Records tab
â”‚   â”œâ”€â”€ My Reviews tab (experts only)
â”‚   â””â”€â”€ Notifications tab
â”‚
â”œâ”€â”€ /records                (Browse all records)
â”‚   â””â”€â”€ /records/[id]       (Record detail + reviews)
â”‚
â”œâ”€â”€ /review                 (Review list - experts only)
â”‚   â””â”€â”€ /review/[id]        (Review form)
â”‚
â”œâ”€â”€ /profile                (Own profile)
â”‚   â””â”€â”€ /profile/[id]       (View other user's profile)
â”‚
â”œâ”€â”€ /expert-application     (Apply to become expert)
â”‚
â”œâ”€â”€ /notifications          (Notifications page)
â”‚
â””â”€â”€ /admin                  (Admin only)
    â”œâ”€â”€ /admin/dashboard    (User management)
    â”œâ”€â”€ /admin/training     (Training data curation)
    â””â”€â”€ /admin/models       (Model version management)
```

---

## ğŸ¨ Color Key for Diagrams

```
ğŸ“± = Mobile App
ğŸŒ = Web Portal
ğŸ’¾ = Database
ğŸ¤– = AI/ML
ğŸ”’ = Authentication
ğŸ“Š = Analytics/Stats
ğŸ¦‹ = Butterfly/Species data
ğŸ‘¨â€ğŸ« = Expert user
ğŸ‘¤ = Regular user
âš™ï¸ = Admin
```

---

## ğŸ“Š Technology Stack Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend     â”‚    Backend       â”‚    AI/ML         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Flutter (Dart) â”‚ Supabase         â”‚ PyTorch          â”‚
â”‚ Next.js        â”‚ PostgreSQL       â”‚ HuggingFace      â”‚
â”‚ React          â”‚ PostgREST        â”‚ Transformers     â”‚
â”‚ TypeScript     â”‚ pg (Node.js)     â”‚ pandas           â”‚
â”‚ Tailwind CSS   â”‚ Supabase JS SDK  â”‚ NumPy            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

For detailed implementation guides:
- [MODEL_VERSION_MANAGEMENT.md](./MODEL_VERSION_MANAGEMENT.md)
- [COMPLETE_DATA_FLOW.md](./COMPLETE_DATA_FLOW.md)
- [QUICK_START_GUIDE.md](./QUICK_START_GUIDE.md)
